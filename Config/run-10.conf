# -------------------------------------------------------------------
# Run-10 config: Re-indexing schema with improved CJK processing
# Schema LS 10
# -------------------------------------------------------------------
use_test_tables = 0
#
# Mounts of Solr server dirs on the build machines
#
# base directory shotz-{1-2}
shared_solr_home_dir =  /htsolr/lss-reindex
# flags on shotz-{1-2}
shared_flags_dir     =  /htsolr/lss-reindex/flags

full_optimize_supported = 0
check_index_supported   = 0
check_index_java_cmd    = /bin/ls

#
# Document subclass
#
document_data_class     = Document::Doc::Data::Ocr::Volume
document_metadata_class = Document::Doc::vSolrMetadataAPI::Schema_LS_10
garbage_ocr_class       = Document::Algorithms::Garbage_2

#
# Sizes
#
num_shards_list         = 1|2|3|4|5|6|7|8|9|10|11|12
queue_slice_size        = 20

#
# Server key to virtual server URI 
#
engine_for_shard_1      = http://solr-sdr-build-new-1:9091/build-1
engine_for_shard_2      = http://solr-sdr-build-new-2:9092/build-2
engine_for_shard_3      = http://solr-sdr-build-new-3:9093/build-3
engine_for_shard_4      = http://solr-sdr-build-new-4:9094/build-4
engine_for_shard_5      = http://solr-sdr-build-new-5:9095/build-5
engine_for_shard_6      = http://solr-sdr-build-new-6:9096/build-6
engine_for_shard_7      = http://solr-sdr-build-new-7:9097/build-7
engine_for_shard_8      = http://solr-sdr-build-new-8:9098/build-8
engine_for_shard_9      = http://solr-sdr-build-new-9:9099/build-9
engine_for_shard_10     = http://solr-sdr-build-new-10:9100/build-10
engine_for_shard_11     = http://solr-sdr-build-new-11:9101/build-11
engine_for_shard_12     = http://solr-sdr-build-new-12:9102/build-12

#
# shard to index directory map
#
dir_for_shard_1         = /htsolr/lss-reindex/shards/1/data/index
dir_for_shard_2         = /htsolr/lss-reindex/shards/2/data/index
dir_for_shard_3         = /htsolr/lss-reindex/shards/3/data/index
dir_for_shard_4         = /htsolr/lss-reindex/shards/4/data/index
dir_for_shard_5         = /htsolr/lss-reindex/shards/5/data/index
dir_for_shard_6         = /htsolr/lss-reindex/shards/6/data/index
dir_for_shard_7         = /htsolr/lss-reindex/shards/7/data/index
dir_for_shard_8         = /htsolr/lss-reindex/shards/8/data/index
dir_for_shard_9         = /htsolr/lss-reindex/shards/9/data/index
dir_for_shard_10        = /htsolr/lss-reindex/shards/10/data/index
dir_for_shard_11        = /htsolr/lss-reindex/shards/11/data/index
dir_for_shard_12        = /htsolr/lss-reindex/shards/12/data/index

#
# **** Driver ****
#
# Default          = 0 in common.conf
driver_driven      = 0

#
# host-to-shard(s) map
#
shards_of_host_solr-sdr-build-new-1  = 1
shards_of_host_solr-sdr-build-new-2  = 2
shards_of_host_solr-sdr-build-new-3  = 3
shards_of_host_solr-sdr-build-new-4  = 4
shards_of_host_solr-sdr-build-new-5  = 5
shards_of_host_solr-sdr-build-new-6  = 6
shards_of_host_solr-sdr-build-new-7  = 7
shards_of_host_solr-sdr-build-new-8  = 8
shards_of_host_solr-sdr-build-new-9  = 9
shards_of_host_solr-sdr-build-new-10 = 10
shards_of_host_solr-sdr-build-new-11 = 11
shards_of_host_solr-sdr-build-new-12 = 12

#
# shard(s)-to-host map
#
host_of_shard_1    = solr-sdr-build-new-1
host_of_shard_2    = solr-sdr-build-new-2
host_of_shard_3    = solr-sdr-build-new-3
host_of_shard_4    = solr-sdr-build-new-4
host_of_shard_5    = solr-sdr-build-new-5
host_of_shard_6    = solr-sdr-build-new-6
host_of_shard_7    = solr-sdr-build-new-7
host_of_shard_8    = solr-sdr-build-new-8
host_of_shard_9    = solr-sdr-build-new-9
host_of_shard_10   = solr-sdr-build-new-10
host_of_shard_11   = solr-sdr-build-new-11
host_of_shard_12   = solr-sdr-build-new-12

#
# producer hosts / shards
#
producers_per_shard = 10
# producers_per_host should be ceiling of:
# (num_shards * producers_per_shard) / num_hosts that are active
# So:
# (12 shards * 10 producers_per_shard) / 4 (earlgrey-*) = 120/4 = 30
producers_per_host = 30
producer_hosts     = earlgrey-1|earlgrey-2|earlgrey-3|earlgrey-4|koolaid-12|koolaid-11|koolaid-9
solr_hosts         = solr-sdr-build-new-1|solr-sdr-build-new-2|solr-sdr-build-new-3|solr-sdr-build-new-4|solr-sdr-build-new-5|solr-sdr-build-new-6|solr-sdr-build-new-7|solr-sdr-build-new-8|solr-sdr-build-new-9|solr-sdr-build-new-10|solr-sdr-build-new-11|solr-sdr-build-new-12

#
# Tomcat pattern
#
tomcat_pattern = /l/local/apache-tomcat-lss-reindex-__SHARD__\s+-D


#
# Error triage - large-scale
# 
# workaround for current shotz bug
#  try setting to around 10%  so at 30K/hour for 24 hr 600K  so 10% = 60K

# Solr could not parse doc
max_indx_errors = 60000;
# Could not create OCR for Solr doc
max_ocr__errors = 60000;
# Could not get metadata for Solr doc
max_meta_errors = 60000;
# Server unavailable
max_serv_errors = 60000;
# N >= numhosts * numproducers/host * queue_slice_size
# Currently 5 * 5 * 5 = 125 
max_no_indexer_avail = 60000;
# Serious stuff
max_crit_errors = 500;


# Regular settings
# Solr could not parse doc
#max_indx_errors = 1000;
# Could not create OCR for Solr doc
#max_ocr__errors = 1000;
# Could not get metadata for Solr doc
#max_meta_errors = 5000;
# Server unavailable
#max_serv_errors = 100;
# N >= numhosts * numproducers/host * queue_slice_size
# Currently 5 * 5 * 5 = 125 
#max_no_indexer_avail = 130;
# Serious stuff
#max_crit_errors = 5;
